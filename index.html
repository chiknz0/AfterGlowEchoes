import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.awt.geom.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;
import java.util.concurrent.CopyOnWriteArrayList;

/**
 * AFTERGLOW ECHOES - Java Edition
 * A standalone desktop version featuring procedural salvage, legendary rolls,
 * and high-fidelity animations.
 */
public class AfterglowEchoes extends JFrame {
    private static final int WIDTH = 1000;
    private static final int HEIGHT = 800;
    
    public AfterglowEchoes() {
        setTitle("Afterglow Echoes | Digital Salvage");
        setSize(WIDTH, HEIGHT);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setResizable(false);
        
        GamePanel panel = new GamePanel();
        add(panel);
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            new AfterglowEchoes().setVisible(true);
        });
    }
}

class GamePanel extends JPanel implements ActionListener, MouseListener, MouseMotionListener {
    private enum State { START, PLAYING, LEGENDARY, FINISHED }
    private State gameState = State.START;
    
    private Timer timer;
    private int score = 0;
    private int timeLeft = 60;
    private long lastTick = 0;
    
    private Point mousePos = new Point(0, 0);
    private boolean isPulling = false;
    private int pullOffset = 0;
    private boolean onCooldown = false;
    
    private final Random rand = new Random();
    private final List<PulledItem> activeItems = new CopyOnWriteArrayList<>();
    private PulledItem currentLegendary = null;
    
    // Procedural Generation Tables
    private final String[] PREFIXES = {"Ancient", "Broken", "Holographic", "Cursed", "Radiant", "Glitched", "Neon", "Dusty", "Forgotten", "Stellar", "Rusty", "Digital", "Ghostly", "Hyper", "Shattered", "Void", "Cyber", "Ethereal"};
    private final String[] MATERIALS = {"Quartz", "Iron", "Plasma", "Carbon", "Light", "Silicon", "Gravity", "Aether", "Nuclear", "Memory", "Onyx", "Obsidian"};
    private final String[] OBJECTS = {"Relic", "Drive", "Shard", "Core", "Module", "Tome", "Capsule", "Fragment"};
    private final String[] EMOJIS = {"ðŸ—¿", "ðŸº", "ðŸ’¾", "ðŸ’½", "ðŸ’Ž", "âœ¨", "ðŸ§¿", "ðŸ”®", "ðŸ“¼", "ðŸ“Ÿ", "ðŸ“–", "ðŸ“œ", "ðŸ’Š", "ðŸ§ª", "ðŸ§©", "â˜„ï¸"};

    public GamePanel() {
        setBackground(new Color(2, 2, 5));
        addMouseListener(this);
        addMouseMotionListener(this);
        
        timer = new Timer(16, this); // ~60 FPS
        timer.start();
        lastTick = System.currentTimeMillis();
    }

    private void performPull() {
        if (gameState != State.PLAYING || onCooldown || isPulling) return;
        
        isPulling = true;
        onCooldown = true;

        // Logic for pull animation and result
        new Thread(() -> {
            try {
                // Animation down
                for (int i = 0; i <= 100; i += 10) {
                    pullOffset = i;
                    Thread.sleep(20);
                }
                
                // Roll for item
                double roll = rand.nextDouble();
                String name = PREFIXES[rand.nextInt(PREFIXES.length)] + " " + 
                             MATERIALS[rand.nextInt(MATERIALS.length)] + " " + 
                             OBJECTS[rand.nextInt(OBJECTS.length)];
                String emoji = EMOJIS[rand.nextInt(EMOJIS.length)];
                int value = rand.nextInt(2000) + 400;
                boolean isLegendary = roll > 0.98;

                if (isLegendary) {
                    value = 50000;
                    currentLegendary = new PulledItem(name, emoji, value, true);
                    gameState = State.LEGENDARY;
                    Thread.sleep(3000);
                    score += value;
                    gameState = State.PLAYING;
                } else {
                    score += value;
                    activeItems.add(new PulledItem(name, emoji, value, false));
                }

                // Animation up
                for (int i = 100; i >= 0; i -= 10) {
                    pullOffset = i;
                    Thread.sleep(20);
                }
                
                isPulling = false;
                Thread.sleep(400); // Cooldown
                onCooldown = false;
            } catch (InterruptedException e) {}
        }).start();
    }

    @Override
    protected void paintComponent(Graphics g) {
        super.paintComponent(g);
        Graphics2D g2 = (Graphics2D) g;
        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

        drawBackground(g2);

        switch (gameState) {
            case START -> drawStartScreen(g2);
            case PLAYING -> drawGame(g2);
            case LEGENDARY -> drawLegendaryScreen(g2);
            case FINISHED -> drawEndScreen(g2);
        }

        drawCursor(g2);
    }

    private void drawBackground(Graphics2D g2) {
        // Nebula Gradient
        RadialGradientPaint p = new RadialGradientPaint(
            new Point2D.Double(getWidth() * 0.3, getHeight() * 0.4),
            (float) getWidth(),
            new float[]{0f, 0.5f},
            new Color[]{new Color(30, 27, 75, 100), new Color(2, 2, 5, 255)}
        );
        g2.setPaint(p);
        g2.fillRect(0, 0, getWidth(), getHeight());

        // Stars
        g2.setColor(new Color(255, 255, 255, 50));
        Random starRand = new Random(42); // Fixed seed for stars
        for (int i = 0; i < 100; i++) {
            int x = starRand.nextInt(getWidth());
            int y = starRand.nextInt(getHeight());
            int size = starRand.nextInt(3);
            g2.fillOval(x, y, size, size);
        }
    }

    private void drawStartScreen(Graphics2D g2) {
        g2.setFont(new Font("Inter", Font.BOLD, 100));
        g2.setColor(Color.WHITE);
        drawCenteredString(g2, "AFTERGLOW", getWidth() / 2, getHeight() / 2 - 50);
        g2.setColor(new Color(21, 94, 117));
        drawCenteredString(g2, "ECHOES", getWidth() / 2, getHeight() / 2 + 50);
        
        g2.setFont(new Font("Inter", Font.PLAIN, 20));
        g2.setColor(Color.GRAY);
        drawCenteredString(g2, "CLICK ANYWHERE TO START SALVAGE", getWidth() / 2, getHeight() / 2 + 150);
    }

    private void drawGame(Graphics2D g2) {
        // HUD
        g2.setColor(new Color(0, 0, 0, 150));
        g2.fillRoundRect(50, 50, 300, 100, 30, 30);
        g2.fillRoundRect(getWidth() - 350, 50, 300, 100, 30, 30);
        
        g2.setFont(new Font("Monospaced", Font.BOLD, 40));
        g2.setColor(Color.CYAN);
        g2.drawString("$" + String.format("%, d", score), 70, 115);
        g2.setColor(timeLeft < 10 ? Color.RED : Color.WHITE);
        g2.drawString(timeLeft + "s", getWidth() - 150, 115);

        // Falling Items
        g2.setFont(new Font("Segoe UI Emoji", Font.PLAIN, 80));
        for (PulledItem item : activeItems) {
            g2.drawString(item.emoji, getWidth() / 2 - 40, item.y);
            item.update();
            if (item.y < -100) activeItems.remove(item);
        }

        // Chute
        g2.setColor(new Color(15, 23, 42));
        g2.fillOval(getWidth() / 2 - 150, getHeight() - 250, 300, 100);
        g2.setColor(new Color(30, 41, 59));
        g2.drawOval(getWidth() / 2 - 150, getHeight() - 250, 300, 100);

        // Hand
        int handY = getHeight() - 250 - 400 + pullOffset * 4;
        g2.setColor(new Color(71, 85, 105));
        g2.fillRoundRect(getWidth() / 2 - 40, handY, 80, 400, 40, 40);
        
        // Reach Button
        g2.setColor(onCooldown ? Color.DARK_GRAY : Color.WHITE);
        g2.fillRoundRect(getWidth() / 2 - 100, getHeight() - 120, 200, 60, 30, 30);
        g2.setColor(Color.BLACK);
        g2.setFont(new Font("Inter", Font.BOLD, 20));
        drawCenteredString(g2, onCooldown ? "WAIT" : "REACH", getWidth() / 2, getHeight() - 85);
    }

    private void drawLegendaryScreen(Graphics2D g2) {
        g2.setColor(new Color(0, 0, 0, 200));
        g2.fillRect(0, 0, getWidth(), getHeight());
        
        g2.setFont(new Font("Inter", Font.BOLD, 20));
        g2.setColor(Color.CYAN);
        drawCenteredString(g2, "LEGENDARY ARTIFACT DETECTED", getWidth() / 2, getHeight() / 2 - 200);
        
        g2.setFont(new Font("Segoe UI Emoji", Font.PLAIN, 200));
        drawCenteredString(g2, currentLegendary.emoji, getWidth() / 2, getHeight() / 2);
        
        g2.setFont(new Font("Inter", Font.BOLD, 40));
        g2.setColor(Color.WHITE);
        drawCenteredString(g2, currentLegendary.name, getWidth() / 2, getHeight() / 2 + 150);
    }

    private void drawEndScreen(Graphics2D g2) {
        g2.setFont(new Font("Inter", Font.BOLD, 60));
        g2.setColor(Color.WHITE);
        drawCenteredString(g2, "SALVAGE COMPLETE", getWidth() / 2, getHeight() / 2 - 100);
        g2.setFont(new Font("Monospaced", Font.BOLD, 80));
        g2.setColor(Color.CYAN);
        drawCenteredString(g2, "$" + String.format("%, d", score), getWidth() / 2, getHeight() / 2 + 20);
        
        g2.setFont(new Font("Inter", Font.PLAIN, 20));
        g2.setColor(Color.GRAY);
        drawCenteredString(g2, "CLICK TO RESTART", getWidth() / 2, getHeight() / 2 + 150);
    }

    private void drawCursor(Graphics2D g2) {
        g2.setColor(new Color(34, 211, 238, 100));
        g2.fillOval(mousePos.x - 15, mousePos.y - 15, 30, 30);
        g2.setColor(new Color(34, 211, 238));
        g2.fillOval(mousePos.x - 3, mousePos.y - 3, 6, 6);
    }

    private void drawCenteredString(Graphics g, String text, int x, int y) {
        FontMetrics metrics = g.getFontMetrics(g.getFont());
        int adv = metrics.stringWidth(text);
        g.drawString(text, x - adv / 2, y);
    }

    @Override
    public void actionPerformed(ActionEvent e) {
        long now = System.currentTimeMillis();
        if (gameState == State.PLAYING && now - lastTick >= 1000) {
            timeLeft--;
            lastTick = now;
        }
        repaint();
    }

    // Input Listeners
    public void mousePressed(MouseEvent e) {
        if (gameState == State.START) {
            gameState = State.PLAYING;
            score = 0;
            timeLeft = 60;
        } else if (gameState == State.PLAYING) {
            performPull();
        } else if (gameState == State.FINISHED) {
            gameState = State.START;
        }
    }

    public void mouseMoved(MouseEvent e) { mousePos = e.getPoint(); }
    public void mouseDragged(MouseEvent e) { mousePos = e.getPoint(); }
    public void mouseClicked(MouseEvent e) {}
    public void mouseReleased(MouseEvent e) {}
    public void mouseEntered(MouseEvent e) {}
    public void mouseExited(MouseEvent e) {}

    // Inner class for item particles
    class PulledItem {
        String name, emoji;
        int value;
        int y = getHeight() - 250;
        double vy = -5;

        PulledItem(String name, String emoji, int value, boolean leg) {
            this.name = name; this.emoji = emoji; this.value = value;
        }

        void update() { 
            y += (int) vy;
            vy -= 0.2; // Gravity upward
        }
    }
}
